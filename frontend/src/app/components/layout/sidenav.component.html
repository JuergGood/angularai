<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav class="sidenav"
               [class.sidenav-collapsed]="isCollapsed()"
               [mode]="isMobile() ? 'over' : 'side'"
               [opened]="!isMobile()"
               [fixedInViewport]="isMobile()">
    <div class="logo-container sidenav-logo">
      <div class="brand-box">
        <span class="brand-g">G</span><span class="brand-1">1</span>
      </div>
      @if (!isCollapsed()) {
        <span class="logo-text">GoodOne</span>
      }
    </div>
    <mat-nav-list>
      @if (authService.isLoggedIn()) {
        <a mat-list-item
           routerLink="/dashboard"
           routerLinkActive="active-link"
           [routerLinkActiveOptions]="{ exact: true }"
           [title]="isCollapsed() ? ('NAV.DASHBOARD_SHORT' | translate) : ''">
          <mat-icon matListItemIcon>dashboard</mat-icon>
          @if (!isCollapsed()) {
            <span matListItemTitle>{{ 'NAV.DASHBOARD' | translate }}</span>
          }
        </a>
        <a mat-list-item routerLink="/tasks" routerLinkActive="active-link" [title]="isCollapsed() ? ('NAV.TASKS' | translate) : ''">
          <mat-icon matListItemIcon>list_alt</mat-icon>
          @if (!isCollapsed()) {
            <span matListItemTitle>{{ 'NAV.TASKS' | translate }}</span>
          }
        </a>
        @if (authService.isAdmin()) {
          <a mat-list-item routerLink="/user-admin" routerLinkActive="active-link" [title]="isCollapsed() ? ('NAV.USER_ADMIN' | translate) : ''">
            <mat-icon matListItemIcon>supervisor_account</mat-icon>
            @if (!isCollapsed()) {
              <span matListItemTitle>{{ 'NAV.USER_ADMIN' | translate }}</span>
            }
          </a>
          <a mat-list-item routerLink="/logs" routerLinkActive="active-link" [title]="isCollapsed() ? ('NAV.LOGS' | translate) : ''">
            <mat-icon matListItemIcon>history</mat-icon>
            @if (!isCollapsed()) {
              <span matListItemTitle>{{ 'NAV.LOGS' | translate }}</span>
            }
          </a>
        }
      }
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <mat-toolbar class="header-toolbar">
      @if (isMobile()) {
        <button mat-icon-button (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>
      }
      <div class="logo-container header-logo">
        <div class="brand-box">
          <span class="brand-g">G</span><span class="brand-1">1</span>
        </div>
        <span class="logo-text header-logo-text">GoodOne</span>
      </div>
      <div class="header-spacer"></div>

      @if (authService.isLoggedIn()) {
        <div class="user-info-group">
          <div class="user-profile-button" [matMenuTriggerFor]="profileMenu">
            <div class="user-avatar">
              <mat-icon>person</mat-icon>
            </div>
            <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
          </div>
          <mat-menu #profileMenu="matMenu">
            <div class="user-menu-header">
              <span class="user-menu-name">{{ authService.currentUser()?.login }}</span>
              @if (authService.isAdmin()) {
                <span class="user-menu-role">{{ 'ADMIN.ROLES.ADMIN' | translate }}</span>
              }
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item routerLink="/profile">
              <mat-icon>person</mat-icon>
              <span>{{ 'NAV.PROFILE' | translate }}</span>
            </button>
            <button mat-menu-item (click)="onLogout()">
              <mat-icon>logout</mat-icon>
              <span>{{ 'NAV.LOGOUT' | translate }}</span>
            </button>
          </mat-menu>

          <button mat-icon-button [matMenuTriggerFor]="settingsMenu" class="settings-button" [title]="'NAV.SETTINGS' | translate">
            <mat-icon>settings</mat-icon>
          </button>
        </div>
      } @else {
        <div class="user-info-group">
          <button mat-button routerLink="/login" class="settings-button">
            <mat-icon>login</mat-icon>
            <span>{{ 'ADMIN.LOGIN' | translate }}</span>
          </button>
          <button mat-icon-button [matMenuTriggerFor]="settingsMenu" class="settings-button" [title]="'NAV.SETTINGS' | translate">
            <mat-icon>settings</mat-icon>
          </button>
        </div>
      }

      <!-- Shared Settings Menu -->
      <mat-menu #settingsMenu="matMenu">
        <!-- Language Submenu -->
        <button mat-menu-item [matMenuTriggerFor]="languageMenu">
          <mat-icon>language</mat-icon>
          <span>{{ 'NAV.LANGUAGE' | translate }}</span>
        </button>

        <!-- Geolocation Toggle (Admin Only) -->
        @if (authService.isAdmin()) {
          <button mat-menu-item (click)="toggleGeolocation()">
            <mat-icon>{{ geolocationEnabled() ? 'location_on' : 'location_off' }}</mat-icon>
            <span>{{ 'NAV.GEOLOCATION' | translate }}: {{ (geolocationEnabled() ? 'COMMON.ON' : 'COMMON.OFF') | translate }}</span>
          </button>

          <button mat-menu-item [matMenuTriggerFor]="recaptchaMenu">
            <mat-icon>security</mat-icon>
            <span>{{ 'NAV.RECAPTCHA' | translate }}</span>
          </button>
        }

        <!-- Help Submenu -->
        @if (authService.isLoggedIn()) {
          <button mat-menu-item [matMenuTriggerFor]="helpMenu">
            <mat-icon>help</mat-icon>
            <span>{{ 'NAV.HELP' | translate }}</span>
          </button>
        }

        <!-- About Submenu -->
        <button mat-menu-item [matMenuTriggerFor]="aboutMenu">
          <mat-icon>info</mat-icon>
          <span>{{ 'NAV.ABOUT' | translate }}</span>
        </button>
      </mat-menu>

      <!-- Submenus -->
      <mat-menu #languageMenu="matMenu">
        <button mat-menu-item (click)="setLanguage('en')">
          <mat-icon>{{ i18nService.currentLang() === 'en' ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>{{ 'NAV.ENGLISH' | translate }}</span>
        </button>
        <button mat-menu-item (click)="setLanguage('de-ch')">
          <mat-icon>{{ i18nService.currentLang() === 'de-ch' ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>{{ 'NAV.GERMAN' | translate }}</span>
        </button>
      </mat-menu>

      <mat-menu #recaptchaMenu="matMenu">
        <button mat-menu-item (click)="setRecaptchaConfig(1)">
          <mat-icon>{{ recaptchaConfigIndex() === 1 ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>1. localhost-score (Enterprise)</span>
        </button>
        <button mat-menu-item (click)="setRecaptchaConfig(2)">
          <mat-icon>{{ recaptchaConfigIndex() === 2 ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>2. localhost-visible (Legacy v2)</span>
        </button>
        <button mat-menu-item (click)="setRecaptchaConfig(3)">
          <mat-icon>{{ recaptchaConfigIndex() === 3 ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>3. productive setup fargate (Enterprise)</span>
        </button>
      </mat-menu>

      <mat-menu #helpMenu="matMenu">
        <button mat-menu-item routerLink="/help/readme">
          <mat-icon>description</mat-icon>
          <span>{{ 'NAV.README' | translate }}</span>
        </button>
        <button mat-menu-item routerLink="/help/user-guide">
          <mat-icon>book</mat-icon>
          <span>{{ 'NAV.USER_GUIDE' | translate }}</span>
        </button>
        @if (authService.isAdmin()) {
          <button mat-menu-item routerLink="/help/admin-guide">
            <mat-icon>admin_panel_settings</mat-icon>
            <span>{{ 'NAV.ADMIN_GUIDE' | translate }}</span>
          </button>
        }
        <button mat-menu-item routerLink="/help/faq">
          <mat-icon>quiz</mat-icon>
          <span>{{ 'NAV.FAQ' | translate }}</span>
        </button>
        <button mat-menu-item routerLink="/help/release-notes">
          <mat-icon>new_releases</mat-icon>
          <span>{{ 'NAV.RELEASE_NOTES' | translate }}</span>
        </button>
      </mat-menu>

      <mat-menu #aboutMenu="matMenu">
        <div class="info-item">
          <mat-icon>dns</mat-icon>
          <div>
            <span class="info-label">{{ 'NAV.BACKEND_VERSION' | translate }}</span>
            <span class="info-value">{{ systemInfo()?.backendVersion || ('COMMON.LOADING' | translate) }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon>code</mat-icon>
          <div>
            <span class="info-label">{{ 'NAV.FRONTEND_VERSION' | translate }}</span>
            <span class="info-value">{{ systemInfo()?.frontendVersion || ('COMMON.LOADING' | translate) }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon>layers</mat-icon>
          <div>
            <span class="info-label">{{ 'NAV.MODE' | translate }}</span>
            <span class="info-value">{{ systemInfo()?.mode || ('COMMON.LOADING' | translate) }}</span>
          </div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="showHelp()">
          <mat-icon>help_outline</mat-icon>
          <span>{{ 'NAV.HELP' | translate }}</span>
        </button>
      </mat-menu>
    </mat-toolbar>
    <main>
      @if (systemInfo()?.landingMessage && showBanner()) {
        <div class="landing-info-banner" [class.hiding]="isHiding()">
          <mat-icon>info</mat-icon>
          <span>{{ systemInfo()?.landingMessage }}</span>
          <button mat-icon-button class="banner-close" (click)="hideBanner()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      }
      <ng-content></ng-content>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
