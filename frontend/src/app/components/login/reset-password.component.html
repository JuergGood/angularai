<div class="reset-page">
  <mat-card class="main-card reset-card">
    <mat-card-header>
      <mat-card-title>{{ 'ADMIN.RESET_PASSWORD' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content style="padding: 24px;">
      @if (!success) {
        <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="reset-form">
          <mat-form-field appearance="outline" style="width: 100%;">
            <mat-label>{{ 'ADMIN.NEW_PASSWORD' | translate }}</mat-label>
            <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" required>
            <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
              <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            @if (resetForm.get('password')?.errors?.['required'] && resetForm.get('password')?.touched) {
              <mat-error>{{ 'ADMIN.ERROR_REQUIRED' | translate }}</mat-error>
            }
            @if (resetForm.get('password')?.errors?.['strength'] && resetForm.get('password')?.touched) {
              <mat-error>{{ 'ADMIN.ERROR_PASSWORD_STRENGTH' | translate }}</mat-error>
            }
          </mat-form-field>

          <div class="password-strength" style="margin-bottom: 16px;">
            <mat-progress-bar mode="determinate" [value]="strengthValue" [color]="strengthColor"></mat-progress-bar>
            <div class="strength-label">
              {{ 'ADMIN.STRENGTH.TITLE' | translate }}:
              <span [class]="strengthColor">{{ strengthLabel | translate }}</span>
            </div>
          </div>

          <mat-form-field appearance="outline" style="width: 100%;">
            <mat-label>{{ 'ADMIN.CONFIRM_PASSWORD' | translate }}</mat-label>
            <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" required>
            <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
              <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            @if (resetForm.get('confirmPassword')?.errors?.['required'] && resetForm.get('confirmPassword')?.touched) {
              <mat-error>{{ 'ADMIN.ERROR_REQUIRED' | translate }}</mat-error>
            }
            @if (resetForm.errors?.['mismatch'] && resetForm.get('confirmPassword')?.touched) {
              <mat-error>{{ 'ADMIN.ERROR_PASSWORD_MATCH' | translate }}</mat-error>
            }
          </mat-form-field>

          @if (error) {
            <div class="error-message" style="color: #f44336; margin-bottom: 16px; text-align: center;">
              {{ error | translate }}
            </div>
          }

          <div class="form-actions">
            <a mat-button routerLink="/login">{{ 'ADMIN.CANCEL' | translate }}</a>
            <button mat-flat-button color="primary" type="submit" [disabled]="resetForm.invalid || loading">
              {{ 'ADMIN.SAVE_PASSWORD' | translate }}
            </button>
          </div>
        </form>
      } @else {
        <div class="success-container reset-success" style="text-align: center;">
          <mat-icon color="primary" style="font-size: 48px; width: 48px; height: 48px; margin-bottom: 16px;">check_circle</mat-icon>
          <p>{{ 'ADMIN.PASSWORD_RESET_SUCCESS' | translate }}</p>
          <div class="form-actions" style="justify-content: center;">
            <a mat-flat-button color="primary" routerLink="/login">{{ 'ADMIN.LOGIN' | translate }}</a>
          </div>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
