# Presentation Generation Workflow

This document describes the automated workflow for generating corporate presentations from Markdown files using Pandoc and custom Java utilities to ensure style consistency and technical integrity.

## Core Components

### 1. Source Files
- **`presentation-slides.md`**: The source content in Markdown format.
- **`template-company.pptx`**: The original corporate template. It serves as the **Visual and Coordinate Reference** for branding (fonts, colors, positions).
- **`reference.pptx`**: A "clean" base template that Pandoc understands perfectly. It provides the **Initial XML Structure** and standard layouts (Title Slide, Title and Content, Two Content). This file is **statically maintained** and was originally generated using Pandoc's default reference document command:
  ```bash
  pandoc --print-default-data-file reference.pptx
  ```
- **`template.pptx`**: The **Reference Document** used by Pandoc. It is the result of applying corporate branding from `template-company.pptx` onto the structural base of `reference.pptx`.

### 2. Who creates and maintains these files?
- **`template-company.pptx`**: Created and updated by the **Corporate Design Team**. It is the source of truth for styles but is NOT used directly by Pandoc.
- **`reference.pptx`**: A static file created once by **Junie AI** (or any developer) using Pandoc. It is a "vanilla" PowerPoint file that serves as a structurally sound container. It rarely needs updates unless Pandoc's internal writer logic changes significantly.
- **`template.pptx`**: Automatically (re)generated by **`TemplateCreator.java`**. This utility merges the branding from the company template with the structure of the reference template.
- **`SoftwareEntwicklungAI.pptx`**: The final output, generated by **Pandoc** and repaired by **`FinalResultFixer.java`**.

### 3. Difference between `reference.pptx` and `template-company.pptx`
- **`template-company.pptx`**: Contains complex layouts, high-resolution graphics, and legacy XML structures that often lead to corruption or layout failures when used directly with Pandoc.
- **`reference.pptx`**: A simplified, structurally sound PPTX container. It ensures Pandoc can reliably map Markdown elements (headings, bullet points, columns) to the correct PowerPoint placeholders without internal writer errors.

## The Transformation Sequence

The journey from a corporate template to a functional Pandoc reference doc follows these steps:

1.  **Extraction (`LayoutInspector.java`)**:
    - This utility is used to inspect `template-company.pptx`.
    - It extracts the exact coordinates (anchors), font names, sizes, and colors for all key placeholders.
    - The output of this tool is used to update the constants and comments in `TemplateCreator.java`.

2.  **Structural Initialization**:
    - `TemplateCreator.java` loads `reference.pptx` as its base.
    - This ensures that the resulting `template.pptx` retains the internal indices and search tree that Pandoc's writer expects.

3.  **Branding Application (`CompanyStyleAligner.java` / `TemplateCreator.java`)**:
    - **`CompanyStyleAligner.java`**: Historically used to post-process a template by iterating through layouts and enforcing styles. In the current workflow, its logic is integrated into `TemplateCreator.java`.
    - **Branding**: Sets the theme fonts to 'Frutiger for ZKB Light' and applies ZKB Blue (`#003cd3`) to titles and slide numbers.
    - **Alignment**: Resizes and repositions placeholders (Title, Body, Slide Number, Footer) to match the coordinates derived from `template-company.pptx`.

4.  **Final Integrity Pass**:
    - Before saving `template.pptx`, `TemplateCreator` calls the integrity validation logic (also found in `FinalResultFixer`) to ensure all shape IDs are unique and dynamic fields are correctly initialized.

## Execution Workflow

To generate the presentation, use the following consolidated command:

```bash
cd doc/history/presentations
# Step 1: Generate PPTX using Pandoc
pandoc presentation-slides.md -o SoftwareEntwicklungAI.pptx --reference-doc template.pptx --resource-path=.

# Step 2: Fix technical integrity and slide numbers in the result
cd ../../../backend
mvn test-compile exec:java "-Dexec.mainClass=ch.goodone.angularai.utils.FinalResultFixer" "-Dexec.classpathScope=test" "-Dcheckstyle.skip"
```

## Maintenance Reference

### Updating Styles
If the corporate branding changes:
1.  Run `LayoutInspector.java` on the new `template-company.pptx`.
2.  Update the coordinates and style constants in `TemplateCreator.java`.
3.  Execute `TemplateCreator.java` to regenerate a clean `template.pptx`.
4.  Run the generation command above to update the final presentation.

### Technical Fixes (`FinalResultFixer.java`)
This mandatory post-processor ensures that:
- **Dynamic Fields**: Converts static `<#>` text into functional `slidenum` fields.
- **Unique IDs**: Re-assigns all shape IDs to a high range (10,000+) to prevent "File is corrupt" errors caused by Pandoc's ID generation.
